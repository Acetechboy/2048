<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ú†Ù„Ù†Ø¬ 2048</title>
  <link rel="stylesheet" href="style/main.css">
  <style>
    body {
      background: #faf8ef;
      font-family: 'Clear Sans', 'Helvetica Neue', Arial, sans-serif;
      text-align: center;
      direction: rtl;
      margin: 0;
      padding: 0;
    }
    .container {
      margin-top: 40px;
    }
    #leaderboard {
      margin-top: 30px;
      text-align: center;
      background: #fff8e1;
      padding: 20px;
      border-radius: 12px;
      width: 320px;
      margin-left: auto;
      margin-right: auto;
    }
    .player {
      margin: 4px 0;
    }
    #logout {
      background: #8f7a66;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 16px;
    }
    #logout:hover {
      background: #a58b71;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>ğŸ”¥ Ú†Ù„Ù†Ø¬ 2048</h1>
    <p id="welcome"></p>
    <button id="logout">Ø®Ø±ÙˆØ¬</button>

    <!-- Ù…Ø­Ù„ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø§Ø²ÛŒ -->
    <div id="gameArea">
      <p>ğŸ® Ø¨Ø§Ø²ÛŒ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø³Øª...</p>
    </div>

    <!-- Ù„ÛŒØ¯Ø±Ø¨Ø±Ø¯ -->
    <div id="leaderboard">
      <h3>ğŸ† Ø¬Ø¯ÙˆÙ„ Ø¨Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§</h3>
      <div id="scores"></div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, orderBy, query, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDhmbx2vQkRBk1r9j21bwuzFw3uEJUdZDY",
      authDomain: "project-4706304311592930157.firebaseapp.com",
      projectId: "project-4706304311592930157",
      storageBucket: "project-4706304311592930157.firebasestorage.app",
      messagingSenderId: "401832134319",
      appId: "1:401832134319:web:99704cf6ec3d2b89cd765a",
      measurementId: "G-LVXWPLG38Q"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const welcomeEl = document.getElementById("welcome");
    const scoresEl = document.getElementById("scores");
    const logoutBtn = document.getElementById("logout");
    const gameArea = document.getElementById("gameArea");

    // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø±
    onAuthStateChanged(auth, async (user) => {
      const name = localStorage.getItem("playerName");
      if (user || name) {
        const displayName = name || user.displayName || "Ø¨Ø§Ø²ÛŒÚ©Ù† Ù†Ø§Ø´Ù†Ø§Ø³";
        welcomeEl.textContent = `Ø³Ù„Ø§Ù… ${displayName} ğŸ‘‹ Ø®ÙˆØ´ Ø§ÙˆÙ…Ø¯ÛŒ!`;
        loadGame();
        loadLeaderboard();
      } else {
        // Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡ Ø¨ÙˆØ¯ Ø¨Ø±Ú¯Ø±Ø¯Ù‡ Ø¨Ù‡ ØµÙØ­Ù‡â€ŒÛŒ ÙˆØ±ÙˆØ¯
        window.location.href = "index.html";
      }
    });

    // Ø¯Ú©Ù…Ù‡ Ø®Ø±ÙˆØ¬
    logoutBtn.addEventListener("click", async () => {
      await signOut(auth);
      localStorage.removeItem("playerName");
      window.location.href = "index.html";
    });

    // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù„ÙˆØ¯ Ø¨Ø§Ø²ÛŒ (Ø§ÛŒÙ†Ø¬Ø§ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ ÙØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ Ø¨Ø§Ø²ÛŒ 2048 Ø±Ùˆ Ù„ÙˆØ¯ Ú©Ù†ÛŒ)
    function loadGame() {
      gameArea.innerHTML = `
        <iframe src="game.html" width="340" height="420" frameborder="0" style="border-radius:12px;"></iframe>
      `;
    }

    // Ù„ÙˆØ¯ Ù„ÛŒØ¯Ø±Ø¨Ø±Ø¯
    async function loadLeaderboard() {
      const q = query(collection(db, "leaderboard"), orderBy("score", "desc"));
      const snapshot = await getDocs(q);
      scoresEl.innerHTML = "";
      snapshot.forEach((doc) => {
        const data = doc.data();
        scoresEl.innerHTML += `<div class="player">â­ ${data.name}: ${data.score}</div>`;
      });
    }
  </script>
</body>
</html>

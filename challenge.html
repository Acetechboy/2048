<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>چلنج 2048</title>
  <link rel="stylesheet" href="style/main.css">
  <style>
    body {
      background: #faf8ef;
      font-family: 'Clear Sans', 'Helvetica Neue', Arial, sans-serif;
      text-align: center;
      direction: rtl;
      margin: 0;
      padding: 0;
    }
    .container {
      margin-top: 40px;
    }
    #leaderboard {
      margin-top: 30px;
      text-align: center;
      background: #fff8e1;
      padding: 20px;
      border-radius: 12px;
      width: 320px;
      margin-left: auto;
      margin-right: auto;
    }
    .player {
      margin: 4px 0;
    }
    #logout {
      background: #8f7a66;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 16px;
    }
    #logout:hover {
      background: #a58b71;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>🔥 چلنج 2048</h1>
    <p id="welcome"></p>
    <button id="logout">خروج</button>

    <!-- محل نمایش بازی -->
    <div id="gameArea">
      <p>🎮 بازی در حال بارگذاری است...</p>
    </div>

    <!-- لیدربرد -->
    <div id="leaderboard">
      <h3>🏆 جدول برترین‌ها</h3>
      <div id="scores"></div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, orderBy, query, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // تنظیمات Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDhmbx2vQkRBk1r9j21bwuzFw3uEJUdZDY",
      authDomain: "project-4706304311592930157.firebaseapp.com",
      projectId: "project-4706304311592930157",
      storageBucket: "project-4706304311592930157.firebasestorage.app",
      messagingSenderId: "401832134319",
      appId: "1:401832134319:web:99704cf6ec3d2b89cd765a",
      measurementId: "G-LVXWPLG38Q"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const welcomeEl = document.getElementById("welcome");
    const scoresEl = document.getElementById("scores");
    const logoutBtn = document.getElementById("logout");
    const gameArea = document.getElementById("gameArea");

    // بررسی ورود کاربر
    onAuthStateChanged(auth, async (user) => {
      const name = localStorage.getItem("playerName");
      if (user || name) {
        const displayName = name || user.displayName || "بازیکن ناشناس";
        welcomeEl.textContent = `سلام ${displayName} 👋 خوش اومدی!`;
        loadGame();
        loadLeaderboard();
      } else {
        // اگر کاربر وارد نشده بود برگرده به صفحه‌ی ورود
        window.location.href = "index.html";
      }
    });

    // دکمه خروج
    logoutBtn.addEventListener("click", async () => {
      await signOut(auth);
      localStorage.removeItem("playerName");
      window.location.href = "index.html";
    });

    // شبیه‌سازی لود بازی (اینجا می‌تونی فایل اصلی بازی 2048 رو لود کنی)
    function loadGame() {
      gameArea.innerHTML = `
        <iframe src="game.html" width="340" height="420" frameborder="0" style="border-radius:12px;"></iframe>
      `;
    }

    // لود لیدربرد
    async function loadLeaderboard() {
      const q = query(collection(db, "leaderboard"), orderBy("score", "desc"));
      const snapshot = await getDocs(q);
      scoresEl.innerHTML = "";
      snapshot.forEach((doc) => {
        const data = doc.data();
        scoresEl.innerHTML += `<div class="player">⭐ ${data.name}: ${data.score}</div>`;
      });
    }
  </script>
</body>
</html>
